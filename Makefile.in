TESTOBJS = test.o tests/test_app.o tests/test_dict.o tests/test_list.o tests/test_sessions.o tests/test_jsession.o tests/test_msession.o
INCLUDES = @SQLITE_CFLAGS@
LIBS = @SQLITE_LIBS@

all: drmaa examples
drmaa: drmaa2.so setup wrapper
tests: test_app
examples: large

drmaa2.so: persistence.o drmaa2.o drmaa2-list.o drmaa2-dict.o
	$(CC) -o $@ -shared $(LIBS) $^

setup: setup_db.o drmaa2.so 
	$(CC) -o $@ $(LIBS) $^

wrapper: wrapper.o drmaa2.so
	$(CC) -o $@ $(LIBS) $^

persistence.o: persistence.c drmaa2-list.c 
	$(CC) $(CFLAGS) $(INCLUDES) -c $^

test_app: test_app.o 
	$(CC) -o $@ $(LIBS) $^

large: large.o drmaa2.so
	$(CC) -o $@ $(LIBS) $^

large.o: examples/large.c
	$(CC) $(INCLUDES) -c $^

%.o: %.c
	$(CC) $(INCLUDES) -c $<

test: $(TESTOBJS) wrapper.o
	$(CC) -lcunit -o $@ 

tests/%.o: tests/%.c tests/%.h 
	$(CC) -c $< -o $@

sqlite3.o: lib/sqlite3.c lib/sqlite3.h
	$(CC) $(CFLAGS) -c $<

clean:
	rm -f setup wrapper
	rm -f *.o
	rm -f *.so
	rm -f tests/*.o test
	rm -f app large test_app
